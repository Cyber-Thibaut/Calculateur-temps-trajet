<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Calculateur de Temps de Trajet</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@latest/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.13.0/css/all.css"
        integrity="sha384-IIED/eyOkM6ihtOiQsX2zizxFBphgnv1zbe1bKA+njdFzkr6cDNy16jfIKWu4FNH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>

<body class="bg-[#1E3A5F] text-white min-h-screen flex flex-col items-center justify-center p-4">

    <h1 class="text-4xl font-bold mb-8 text-center">Calculateur de temps de trajet</h1>

    <div class="w-full max-w-lg bg-[#2D4F78] p-8 rounded-lg shadow-lg space-y-6">
        <div>
            <label for="from" class="block text-lg font-medium mb-2">Lieu de départ :</label>
            <input id="from" type="text" placeholder="Cliquez sur la carte pour sélectionner"
                class="input input-bordered w-full text-black" />
        </div>

        <div>
            <label for="to" class="block text-lg font-medium mb-2">Lieu de destination :</label>
            <input id="to" type="text" placeholder="Cliquez sur la carte pour sélectionner"
                class="input input-bordered w-full text-black" />
        </div>

        <button onclick="calculateRoute()" class="btn btn-primary w-full text-lg">Calculer le temps de trajet</button>

        <div id="output" class="text-lg mt-4"></div>
    </div>

    <div id="map" class="w-full max-w-4xl h-96 mt-8 rounded-lg shadow-lg"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script>
        let map = L.map('map').setView([45.2009, 6.6634], 13); // Centré sur Modane
        let fromMarker, toMarker, routeLine;
        let fromLatLng, toLatLng;

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);

        map.on('click', function (e) {
            if (!fromLatLng) {
                fromLatLng = e.latlng;
                fromMarker = L.marker(fromLatLng).addTo(map);
                document.getElementById('from').value = `${fromLatLng.lat}, ${fromLatLng.lng}`;
            } else if (!toLatLng) {
                toLatLng = e.latlng;
                toMarker = L.marker(toLatLng).addTo(map);
                document.getElementById('to').value = `${toLatLng.lat}, ${toLatLng.lng}`;
            }
        });

        function calculateRoute() {
            if (!fromLatLng || !toLatLng) {
                alert("Veuillez sélectionner à la fois un lieu de départ et un lieu de destination sur la carte.");
                return;
            }

            const apiKey = '5b3ce3597851110001cf6248b28544f0b97a4a56943dac9d23fcdcc0'; // Remplacez par votre clé OpenRouteService
            const url = `https://api.openrouteservice.org/v2/directions/driving-car?api_key=${apiKey}&start=${fromLatLng.lng},${fromLatLng.lat}&end=${toLatLng.lng},${toLatLng.lat}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const durationInSeconds = data.features[0].properties.summary.duration;
                    // Conversion du temps en jours, heures, minutes et secondes
                    const days = Math.floor(durationInSeconds / 86400);
                    const hours = Math.floor((durationInSeconds % 86400) / 3600);
                    const minutes = Math.floor((durationInSeconds % 3600) / 60);
                    const seconds = Math.floor(durationInSeconds % 60);

                    const distance = data.features[0].properties.summary.distance;

                    // Affichage du temps formaté
                    let formattedDuration = '';

                    if (days > 0) {
                        formattedDuration += `${days} jour${days > 1 ? 's' : ''}, `;
                    }
                    formattedDuration += `${hours.toString().padStart(2, '0')}h `;
                    formattedDuration += `${minutes.toString().padStart(2, '0')}m `;
                    formattedDuration += `${seconds.toString().padStart(2, '0')}s`;

                    const distanceInKm = (data.features[0].properties.summary.distance / 1000).toFixed(2);

                    document.getElementById('output').innerHTML = `
                        <p>Durée du trajet: ${formattedDuration}</p>
                        <p>Distance: ${distanceInKm} km</p>
                    `;


                    const route = data.features[0].geometry;
                    const coordinates = route.coordinates.map(coord => [coord[1], coord[0]]);

                    // Tracer le trajet
                    if (routeLine) {
                        map.removeLayer(routeLine);
                    }
                    routeLine = L.polyline(coordinates, { color: 'blue' }).addTo(map);

                    // Réinitialiser les champs et les marqueurs
                    fromLatLng = null;
                    toLatLng = null;
                    document.getElementById('from').value = '';
                    document.getElementById('to').value = '';

                    if (fromMarker) {
                        map.removeLayer(fromMarker);
                    }
                    if (toMarker) {
                        map.removeLayer(toMarker);
                    }
                })
                .catch(error => {
                    document.getElementById('output').innerHTML = `Erreur: ${error}`;
                });
        }
    </script>
</body>

</html>
